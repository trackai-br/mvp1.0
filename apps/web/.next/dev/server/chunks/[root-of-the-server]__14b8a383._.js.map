{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/guilhermesimas/Documents/hub-server-side-tracking/packages/shared/src/index.ts"],"sourcesContent":["import { z } from 'zod';\n\nexport const trackingEnvironmentSchema = z.enum(['lp', 'wpp', 'telegram']);\nexport const gatewaySchema = z.enum(['perfectpay']);\n\nexport const setupSessionCreateSchema = z.object({\n  projectName: z.string().min(1),\n  trackingEnvironment: trackingEnvironmentSchema,\n  landingUrl: z.string().url(),\n  meta: z.object({\n    pixelId: z.string().min(3),\n    accessToken: z.string().min(10),\n    adAccountId: z.string().min(3)\n  }),\n  gateway: z.object({\n    platform: gatewaySchema,\n    apiKey: z.string().min(8),\n    webhookSecret: z.string().min(8)\n  })\n});\n\nexport type SetupSessionCreateInput = z.infer<typeof setupSessionCreateSchema>;\n\nexport const stepStatusSchema = z.enum(['pending', 'ok', 'failed']);\n\nexport const setupSessionStatusSchema = z.object({\n  id: z.string(),\n  projectName: z.string(),\n  state: z.enum(['created', 'validated', 'troubleshooting_required']),\n  createdAt: z.string(),\n  updatedAt: z.string(),\n  input: setupSessionCreateSchema,\n  webhook: z.object({\n    provider: gatewaySchema,\n    path: z.string(),\n    url: z.string().url(),\n    token: z.string()\n  }),\n  checks: z.object({\n    gatewayCredentials: stepStatusSchema,\n    metaToken: stepStatusSchema,\n    landingProbe: stepStatusSchema\n  }),\n  issues: z.array(z.string())\n});\n\nexport type SetupSessionStatus = z.infer<typeof setupSessionStatusSchema>;\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA;;AAEO,MAAM,4BAA4B,oLAAC,CAAC,IAAI,CAAC;IAAC;IAAM;IAAO;CAAW;AAClE,MAAM,gBAAgB,oLAAC,CAAC,IAAI,CAAC;IAAC;CAAa;AAE3C,MAAM,2BAA2B,oLAAC,CAAC,MAAM,CAAC;IAC/C,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC5B,qBAAqB;IACrB,YAAY,oLAAC,CAAC,MAAM,GAAG,GAAG;IAC1B,MAAM,oLAAC,CAAC,MAAM,CAAC;QACb,SAAS,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACxB,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QAC5B,aAAa,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAC9B;IACA,SAAS,oLAAC,CAAC,MAAM,CAAC;QAChB,UAAU;QACV,QAAQ,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;QACvB,eAAe,oLAAC,CAAC,MAAM,GAAG,GAAG,CAAC;IAChC;AACF;AAIO,MAAM,mBAAmB,oLAAC,CAAC,IAAI,CAAC;IAAC;IAAW;IAAM;CAAS;AAE3D,MAAM,2BAA2B,oLAAC,CAAC,MAAM,CAAC;IAC/C,IAAI,oLAAC,CAAC,MAAM;IACZ,aAAa,oLAAC,CAAC,MAAM;IACrB,OAAO,oLAAC,CAAC,IAAI,CAAC;QAAC;QAAW;QAAa;KAA2B;IAClE,WAAW,oLAAC,CAAC,MAAM;IACnB,WAAW,oLAAC,CAAC,MAAM;IACnB,OAAO;IACP,SAAS,oLAAC,CAAC,MAAM,CAAC;QAChB,UAAU;QACV,MAAM,oLAAC,CAAC,MAAM;QACd,KAAK,oLAAC,CAAC,MAAM,GAAG,GAAG;QACnB,OAAO,oLAAC,CAAC,MAAM;IACjB;IACA,QAAQ,oLAAC,CAAC,MAAM,CAAC;QACf,oBAAoB;QACpB,WAAW;QACX,cAAc;IAChB;IACA,QAAQ,oLAAC,CAAC,KAAK,CAAC,oLAAC,CAAC,MAAM;AAC1B"}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///Users/guilhermesimas/Documents/hub-server-side-tracking/apps/web/src/lib/server/setup-store.ts"],"sourcesContent":["import type { SetupSessionCreateInput, SetupSessionStatus } from '@hub/shared';\n\nconst sessions = new Map<string, SetupSessionStatus>();\n\nfunction generateToken() {\n  return crypto.randomUUID().replace(/-/g, '');\n}\n\nfunction buildWebhookData(input: {\n  requestOrigin: string;\n  sessionId: string;\n  token: string;\n}) {\n  const path = `/api/v1/webhooks/perfectpay/${input.sessionId}/${input.token}`;\n  return {\n    provider: 'perfectpay' as const,\n    path,\n    url: `${input.requestOrigin}${path}`,\n    token: input.token\n  };\n}\n\nexport function createSetupSession(input: {\n  payload: SetupSessionCreateInput;\n  requestOrigin: string;\n}): SetupSessionStatus {\n  const now = new Date().toISOString();\n  const id = crypto.randomUUID();\n  const token = generateToken();\n\n  const session: SetupSessionStatus = {\n    id,\n    projectName: input.payload.projectName,\n    state: 'created',\n    createdAt: now,\n    updatedAt: now,\n    input: input.payload,\n    webhook: buildWebhookData({\n      requestOrigin: input.requestOrigin,\n      sessionId: id,\n      token\n    }),\n    checks: {\n      gatewayCredentials: 'pending',\n      metaToken: 'pending',\n      landingProbe: 'pending'\n    },\n    issues: []\n  };\n\n  sessions.set(id, session);\n  return session;\n}\n\nexport function getSetupSession(id: string): SetupSessionStatus | null {\n  return sessions.get(id) ?? null;\n}\n\nexport function saveSetupSession(session: SetupSessionStatus): void {\n  session.updatedAt = new Date().toISOString();\n  sessions.set(session.id, session);\n}\n"],"names":[],"mappings":";;;;;;;;AAEA,MAAM,WAAW,IAAI;AAErB,SAAS;IACP,OAAO,OAAO,UAAU,GAAG,OAAO,CAAC,MAAM;AAC3C;AAEA,SAAS,iBAAiB,KAIzB;IACC,MAAM,OAAO,CAAC,4BAA4B,EAAE,MAAM,SAAS,CAAC,CAAC,EAAE,MAAM,KAAK,EAAE;IAC5E,OAAO;QACL,UAAU;QACV;QACA,KAAK,GAAG,MAAM,aAAa,GAAG,MAAM;QACpC,OAAO,MAAM,KAAK;IACpB;AACF;AAEO,SAAS,mBAAmB,KAGlC;IACC,MAAM,MAAM,IAAI,OAAO,WAAW;IAClC,MAAM,KAAK,OAAO,UAAU;IAC5B,MAAM,QAAQ;IAEd,MAAM,UAA8B;QAClC;QACA,aAAa,MAAM,OAAO,CAAC,WAAW;QACtC,OAAO;QACP,WAAW;QACX,WAAW;QACX,OAAO,MAAM,OAAO;QACpB,SAAS,iBAAiB;YACxB,eAAe,MAAM,aAAa;YAClC,WAAW;YACX;QACF;QACA,QAAQ;YACN,oBAAoB;YACpB,WAAW;YACX,cAAc;QAChB;QACA,QAAQ,EAAE;IACZ;IAEA,SAAS,GAAG,CAAC,IAAI;IACjB,OAAO;AACT;AAEO,SAAS,gBAAgB,EAAU;IACxC,OAAO,SAAS,GAAG,CAAC,OAAO;AAC7B;AAEO,SAAS,iBAAiB,OAA2B;IAC1D,QAAQ,SAAS,GAAG,IAAI,OAAO,WAAW;IAC1C,SAAS,GAAG,CAAC,QAAQ,EAAE,EAAE;AAC3B"}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///Users/guilhermesimas/Documents/hub-server-side-tracking/apps/web/src/app/api/v1/setup/sessions/route.ts"],"sourcesContent":["import { setupSessionCreateSchema } from '@hub/shared';\nimport { NextResponse } from 'next/server';\nimport { createSetupSession } from '@/lib/server/setup-store';\n\nexport const runtime = 'nodejs';\n\nexport async function POST(request: Request) {\n  const body = await request.json().catch(() => null);\n  const parsed = setupSessionCreateSchema.safeParse(body);\n\n  if (!parsed.success) {\n    return NextResponse.json(parsed.error.flatten(), { status: 400 });\n  }\n\n  const origin = new URL(request.url).origin;\n  const session = createSetupSession({\n    payload: parsed.data,\n    requestOrigin: origin\n  });\n\n  return NextResponse.json(session, { status: 201 });\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,OAAgB;IACzC,MAAM,OAAO,MAAM,QAAQ,IAAI,GAAG,KAAK,CAAC,IAAM;IAC9C,MAAM,SAAS,gKAAwB,CAAC,SAAS,CAAC;IAElD,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,gJAAY,CAAC,IAAI,CAAC,OAAO,KAAK,CAAC,OAAO,IAAI;YAAE,QAAQ;QAAI;IACjE;IAEA,MAAM,SAAS,IAAI,IAAI,QAAQ,GAAG,EAAE,MAAM;IAC1C,MAAM,UAAU,IAAA,6KAAkB,EAAC;QACjC,SAAS,OAAO,IAAI;QACpB,eAAe;IACjB;IAEA,OAAO,gJAAY,CAAC,IAAI,CAAC,SAAS;QAAE,QAAQ;IAAI;AAClD"}}]
}